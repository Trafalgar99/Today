# 2020.9.28

## 单词x100

## JavaScript语法

1. 宏任务与微任务  优先级 微任务 > 宏任务
2. 定时器是宏任务，定时器里的任务未必一定会经过定时器所设定的时间后执行，这要取决于后面的同步代码`

```js
setTimeout(()=>{
    console.log('timer');
    
},4);

console.log('flag');

for(let i=0;i<10000;i++){
    console.log("");
}
```

3. 当有多个宏任务时，会先执行最先完成的

```js
setTimeout(()=>{
    console.log('timer 1');
},2000);
setTimeout(()=>{
    console.log('timer 2');
},1000);

console.log('flag');

for(let i=0;i<10000;i++){
    console.log('');
}

//先输出 timer2 后输出timer1
```

4. promise代码是微任务

```js
setTimeout(()=>{
    console.log('timer');	//宏任务代码
});

new Promise(resolve=>{
    console.log('promise');	//同步代码
    resolve();
}).then(()=>{
    console.log('then');	//微任务代码
});

console.log('flag');	//同步代码

//输出顺序： promise  flag  then  timer

// *********************************************************
setTimeout(()=>{
    console.log('timer');	//宏任务代码
    
    //
    new Promise(resolve=>{
    	console.log('settime promise');	//二级同步代码
    	resolve();
	}).then(()=>{
    	console.log('settime then');	//二级微任务代码
	});
    
    
},0);

new Promise(resolve=>{
    console.log('promise');	//同步代码
    resolve();
}).then(()=>{
    console.log('then');	//微任务代码
});

console.log('flag');	//同步代码

//执行结果：promise  flag  then  timer  ‘settime promise’   ‘settime then’
```

5. dom渲染任务是宏任务
6. 进度条例子

```js
function handle(){
    let i = 0;
    
    (function run(){
        if(++i<=100){
            hd.innerHTML = i;
            hd.style.width = i+'%';
            console.log(i);
        	setTimeout(run,100);
        }
    })();
}
```

7. promise完成任务拆分

```js
function sum(num){
    return new Promise(resolve=>{
        setTimeout(()={
            let count = 0;
            for(let i=0;i<num;i++){
                count+= num--;
            }
        	resolve(count);
        });
    });
}

async function hd(num){
    let res = await sum(num);
    console.log(res);
}

hd(987654321);
console.log('flag');

//或者使用微任务改造
async function hd(num){
    let res = await Promise.resolve().then(_=>{
      let count = 0;
      for(let i=0;i<num;i++){
        count+= num--;
      }
      return count;
    });
    console.log(res);
}

hd(987654321);
console.log('flag');
```

